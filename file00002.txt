USE [abtzfdevfac530]
GO
/****** Object:  StoredProcedure [dbo].[TZFSP_MEMBER_SEARCH]    Script Date: 5/31/2018 3:37:10 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
ALTER PROCEDURE [dbo].[TZFSP_MEMBER_SEARCH]
@pMEME_CK varchar(MAX) = null,
@pMEPE_ELIG_IND varchar(MAX) = null
--@pAsOfDate varchar(MAX)

AS
BEGIN

SET NOCOUNT ON;

DECLARE @SQL AS NVARCHAR(MAX);

---SET @SQL='SELECT G.GRGR_ID, G.GRGR_CK, G.GRGR_NAME, M.MEME_CK, M.MEPE_ELIG_IND, M.CSPD_CAT, M.MEPE_EFF_DT , M.MEPE_TERM_DT FROM CMC_GRGR_GROUP AS G INNER JOIN CMC_MEPE_PRCS_ELIG AS M ON G.GRGR_CK= M.GRGR_CK  WHERE MEME_CK IN (' + @pMEME_CK + ')
---and MEPE_ELIG_IND=''' + @pMEPE_ELIG_IND + ''''

--- and MEPE_EFF_DT <= ''' + @pAsOfDate + ''' and MEPE_TERM_DT > ''' + @pAsOfDate + ''''

SET @SQL='SELECT G.GRGR_ID, G.GRGR_CK, G.GRGR_NAME, M.MEME_CK, M.MEPE_ELIG_IND, M.CSPD_CAT, M.MEPE_EFF_DT , M.MEPE_TERM_DT,PLDS.CSPI_ID,
       PLDS.PLDS_DESC,PDDS.PDPD_ID,PDDS.PDDS_PROD_TYPE
FROM CMC_GRGR_GROUP G
INNER JOIN CMC_MEPE_PRCS_ELIG M ON G.GRGR_CK=M.GRGR_CK
INNER JOIN CMC_PLDS_PLAN_DESC PLDS ON M.CSPI_ID= PLDS.CSPI_ID 
INNER JOIN CMC_PDDS_PROD_DESC PDDS ON M.PDPD_ID= PDDS.PDPD_ID WHERE MEME_CK IN (' + @pMEME_CK + ')
and MEPE_ELIG_IND=''' + @pMEPE_ELIG_IND + ''''

Exec(@SQL)



END
